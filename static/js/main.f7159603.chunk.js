(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{126:function(e,t,n){e.exports=function(){return new Worker(n.p+"3d326f9fb3ff3d04e088.worker.js")}},127:function(e,t,n){e.exports=n(313)},128:function(e,t,n){},133:function(e,t){},134:function(e,t){},135:function(e,t){},312:function(e,t,n){},313:function(e,t,n){"use strict";n.r(t);n(128);var i=n(4),o=n(1),r=n(2),a=n(13),s=n(12),d=n(14),u=function(){function e(){Object(o.a)(this,e),this._events={}}return Object(r.a)(e,[{key:"on",value:function(e,t,n){return e&&t?((this._events[e]||(this._events[e]=[])).push({callback:t,context:n||this}),this):this}},{key:"off",value:function(e,t){if(!this._events)return this;var n=this._events;return(e?[e]:Object.keys(n)).forEach(function(e){var i=n[e];if(i)if(t){var o=i.filter(function(e){return e.callback!==t});n[e]=o}else delete n[e]}),this}},{key:"trigger",value:function(e){if(!this._events||!e)return this;for(var t=this._events[e],n=this._events.all,i=arguments.length,o=new Array(i>1?i-1:0),r=1;r<i;r++)o[r-1]=arguments[r];return t&&this._triggerHandlers(t,o),n&&this._triggerHandlers(n,[e].concat(o)),this}},{key:"_triggerHandlers",value:function(e,t){e.forEach(function(e){e.callback.apply(e.context,t)})}}]),e}(),h=function(){function e(){Object(o.a)(this,e),this.graph=null}return Object(r.a)(e,[{key:"addTo",value:function(e){return this.graph=e,e.addCell(this),this}}]),e}(),c=function(e,t){return"c"+e+"n"+t},l=function(e,t,n){return c(e,t)+"input"+n},f=function(e,t,n){return c(e,t)+"output"+n},v=function(e,t,n){return c(e,t)+"$param$"+n},g=function(e,t){return e+" "+t},m=function(e){function t(e){var n;Object(o.a)(this,t),(n=Object(a.a)(this,Object(s.a)(t).call(this))).id=c(e.contextId,e.nodeId);var i=e.nodeType;return i.endsWith("Node")&&(i=i.slice(0,i.length-4)),n.type=i,n.nodeLabel=g(i,e.nodeId),n._size=null,n._pos=null,n}return Object(d.a)(t,e),Object(r.a)(t,[{key:"getSize",value:function(){return this._size}},{key:"setSize",value:function(e){this._size=e}},{key:"getPos",value:function(){return this._pos}},{key:"setPos",value:function(e){return this._pos=e,this}},{key:"shouldRender",value:function(){return!!this._pos}}]),t}(h),_=n(50),y=n(8),p=n.n(y),k=function(){function e(t,n){Object(o.a)(this,e),this._items={},n=p()(n,{trackEnter:!1,trackExit:!1}),this._trackEnter=n.trackEnter,this._trackExit=n.trackExit,n.trackEnter&&(this._enter=[]),n.trackExit&&(this._exit=[]),t&&Object(_.isArray)(t)&&this.addItems(t)}return Object(r.a)(e,[{key:"add",value:function(e,t){if(2!==arguments.length)throw new Error("Should have two arguments");return this._trackEnter&&this._enter.push(t),this.set(e,t),this}},{key:"addItems",value:function(e){var t=this;e.forEach(function(e){t.add(e.id,e)})}},{key:"has",value:function(e){return this._items.hasOwnProperty(e)}},{key:"get",value:function(e){return this._items[e]}},{key:"set",value:function(e,t){return this._items[e]=t,this}},{key:"remove",value:function(e){return this._trackExit&&this._items[e]&&this._exit.push(this._items[e]),delete this._items[e],this}},{key:"values",value:function(){return Object.values(this._items)}},{key:"size",value:function(){return Object.keys(this._items).length}},{key:"enter",value:function(){if(!this._trackEnter)throw new Error("Should set trackEnter=true");return this._enter}},{key:"exit",value:function(){if(!this._trackExit)throw new Error("Should set trackExit=true");return this._exit}},{key:"clearEnterExit",value:function(){this._trackEnter&&(this._enter=[]),this._trackExit&&(this._exit=[])}}]),e}(),N=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this)))._nodes=new k(null,{trackExit:!0}),e._edges=new k(null,{trackExit:!0}),e._out={},e._in={},e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"addCell",value:function(e){e instanceof m?this.addNode(e):this.addEdge(e)}},{key:"addNode",value:function(e){this._nodes.add(e.id,e),this._shouldRedraw()}},{key:"removeNodeAndEdges",value:function(e){this.removeNode(e),this.removeEdgesOfNode(e)}},{key:"removeNode",value:function(e){this._nodes.remove(e),this._shouldRedraw()}},{key:"removeEdgesOfNode",value:function(e){var t=this,n=this._out[e];n&&Object.keys(n).forEach(function(e){t.removeEdge(e)});var i=this._in[e];i&&Object.keys(i).forEach(function(e){t.removeEdge(e)}),delete this._out[e],delete this._in[e]}},{key:"addEdge",value:function(e){var t=e.source.id;if(!this._out[t]||!this._out[t][e.id]){this._edges.add(e.id,e),this._out[t]||(this._out[t]={}),this._out[t][e.id]=!0;var n=e.target.id;this._in[n]||(this._in[n]={}),this._in[n][e.id]=!0}}},{key:"removeEdge",value:function(e){this._edges.remove(e),this._shouldRedraw()}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"getNodesToRemove",value:function(){return this._nodes.exit()}},{key:"getNode",value:function(e){return this._nodes.get(e)}},{key:"getEdges",value:function(){return this._edges.values()}},{key:"getEdgesToRemove",value:function(){return this._edges.exit()}},{key:"getEdge",value:function(e){return this._edges.get(e)}},{key:"_shouldRedraw",value:function(){this.trigger("shouldRedraw")}},{key:"renderEnd",value:function(){this._nodes.clearEnterExit(),this._edges.clearEnterExit()}}]),t}(u),b=n(70),w=n.n(b),x=function(){},P=function(e){return!e||0===e.length},O=n(32),E=n.n(O),I=n(126),L=n.n(I),T=[],M=function(e,t){var n=(t=p()(t||{callback:x})).marginX||0,i=t.marginY||0,o={rankdir:"LR",marginx:n,marginy:i},r=A(e,{directed:!0,setNodeLabel:j,setEdgeLabel:R});r.setGraph(o);var a=function(o){C(o,e,t),t.callback(function(e){var t=e.graph();return{marginx:n,marginy:i,width:Math.abs(t.width-2*n),height:Math.abs(t.height-2*i)}}(o))};t.useWorker?function(e){if(T.length)return T[0];var t=new L.a;return t.onmessage=function(t){var n=E.a.json.read(t.data);e(n)},T.push(t),t}(a).postMessage(E.a.json.write(r)):(w.a.layout(r,{debugTiming:!0}),a(r))},j=function(e){var t=e.getSize();return{width:t.width,height:t.height}},R=function(e){return{id:e.id}},A=function(e,t){var n=new w.a.graphlib.Graph,i=t.setNodeLabel||x,o=t.setEdgeLabel||x;return e.getNodes().forEach(function(e){n.setNode(e.id,i(e))}),e.getEdges().forEach(function(e){n.setEdge(e.source.id,e.target.id,o(e))}),n},C=function(e,t){e.nodes().forEach(function(n){var i=e.node(n);t.getNode(n).setPos({x:i.x,y:i.y})}),e.edges().forEach(function(n){var i=e.edge(n);t.getEdge(i.id).setPoints(i.points)})},S=function(e,t){switch(e){case"AudioDestination":return t?"#5D4037":"#37474F";case"AudioBufferSource":case"Oscillator":return"#009688";case"BiquadFilter":case"Convolver":case"Delay":case"DynamicsCompressor":case"IIRFilter":case"Panner":case"StereoPanner":case"WaveShaper":return"#2196F3";case"Analyser":return"#00BCD4";case"Gain":case"ChannelMerger":case"ChannelSplitter":return"#3F51B5";case"MediaElementAudioSource":case"MediaStreamAudioDestination":case"MediaStreamAudioSource":return"#9C27B0";case"ScriptProcessor":default:return"#C62828"}},B={IN:Symbol("IN"),OUT:Symbol("OUT"),PARAM:Symbol("PARAM")},D=function(e){var t=0;return e.getPorts().forEach(function(e){e.type===B.IN?t=10:e.type===B.PARAM&&0===t&&(t=5)}),t},z=function(e,t){var n,o,r,a;switch(e.type){case B.IN:n=5,o=-10,r=new i.fabric.Circle({radius:10,fill:"green",top:n,left:o,stroke:"black",strokeWidth:1}),a=new i.fabric.Text(e.text,{fontSize:14,fontFamily:"Segoe UI, sans-serif",fill:"black",top:n+2.5,left:o+6});break;case B.OUT:n=t.height/2-10,o=t.width-10,r=new i.fabric.Circle({radius:10,fill:"red",top:n,left:o,stroke:"black",strokeWidth:1}),a=new i.fabric.Text(e.text,{fontSize:14,fontFamily:"Segoe UI, sans-serif",fill:"black",left:o+6,top:n+2.5});break;case B.PARAM:r=new i.fabric.Circle({radius:5,fill:"yellow",top:(e.y||0)-5,left:-5,stroke:"black",strokeWidth:1}),a=new i.fabric.Text(e.text,{fontSize:12,fontFamily:"Segoe UI, sans-serif",fill:"#eee",left:12,top:(e.y||0)-5-2});break;default:throw new Error("should not reach here")}return new i.fabric.Group([r,a],{})},W=function(e,t){var n=Math.pow(10,t||0);return e.x=Math.round(e.x*n)/n,e.y=Math.round(e.y*n)/n,e},G=function(e,t,n){var i=function(e,t){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}(e,t);if(0===i)throw new Error("from should not be the same as to");return q(e,t,n/i)},q=function(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}},U=function(e,t,n,o){o=p()(o,{showControlPoints:!1});var r=t.getPoints(),a=r?r.slice(1,r.length-1):[],s=H(e,t,a),d=s.sourcePoint,u=s.targetPoint;n&&o.showControlPoints&&(Y(n,d,{fill:"blue"}),Y(n,u,{fill:"purple"}),a.forEach(function(e){Y(n,e)}));var h=X(d,u,a),c=F(d,u,a);return{path:new i.fabric.Path(h,{fill:"",stroke:"black",strokeWidth:1.5,selectable:!1}),arrowHead:new i.fabric.Path(c,{fill:"black",selectable:!1}),sourcePoint:d,targetPoint:u}},H=function(e,t,n){var i,o,r=t.source,a=e.getNode(r.id),s=a.getPos(),d=a.getSize(),u={x:s.x+d.width/2,y:s.y},h=t.target,c=e.getNode(h.id),l=c.getPortById(h.port),f=c.getPos(),v=c.getSize(),g={x:f.x-v.width/2,y:f.y-v.height/2+l.y};n.length?(i=n[0],o=n[n.length-1]):(i=g,o=u);var m=G(u,i,10),_=l.type===B.IN?10:5,y=G(g,o,_);return{sourcePoint:W(m),targetPoint:W(y)}},F=function(e,t,n){var i,o=function(e,t){var n=-(t.y-e.y),i=t.x-e.x;return Math.atan2(n,i)}(n&&n.length?n[n.length-1]:e,t),r=[];return i=K("M",t),r.push(i),i=K("L",{x:t.x-12*Math.cos(-o-Math.PI/6),y:t.y-12*Math.sin(-o-Math.PI/6)}),r.push(i),i=K("L",{x:t.x-12*Math.cos(-o+Math.PI/6),y:t.y-12*Math.sin(-o+Math.PI/6)}),r.push(i),r.push("Z"),r.join(" ")},Y=function(e,t,n){var o=(n=n||{}).radius||3,r=new i.fabric.Circle({radius:o,fill:n.fill||"black",top:t.y-o,left:t.x-o});e.add(r)},X=function(e,t,n){var i,o=[];i=K("M",e),o.push(i);for(var r,a,s,d,u,h,c,l=0,f=n.length;l<f;l++)r=n[l],a=n[l-1]||e,s=n[l+1]||t,d=V(a,r),u=V(r,s),h={x:1/3*d.x+2/3*r.x,y:2/3*r.y+1/3*d.y},c={x:1/3*u.x+2/3*r.x,y:2/3*r.y+1/3*u.y},i=K("L",d),o.push(i),i=J([h,c,u]),o.push(i);return i=K("L",t),o.push(i),o.join(" ")},K=function(e,t){return e+" "+t.x+" "+t.y},J=function(e){if(3!==e.length)throw new Error("should be 3 points but got ",e.length);var t=[];return t.push("C"),e.forEach(function(e){t.push(e.x),t.push(e.y)}),t.join(" ")},V=function(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}},Z=new k,$=function(e){if(!e||!e.id)throw new Error("rendered object is not returned or does not have id");Z.add(e.id,e)},Q=function(e,t){console.log("start render...");var n=performance.now();t.getNodes().forEach(function(t){var n;Z.has(t.id)?function(e,t){var n=t.getPos(),i=t.getSize(),o=D(t);e.set({left:Math.round(n.x-i.width/2-o),top:Math.round(n.y-i.height/2)}),e.setCoords()}(n=Z.get(t.id),t):t.shouldRender()&&(n=function(e,t){var n=t.getPos(),o=t.getSize(),r=[],a=new i.fabric.Rect({fill:S(t.type),width:o.width,height:o.height,rx:5,ry:5});r.push(a);var s=new i.fabric.Text(t.nodeLabel,{fontSize:14,fontFamily:"Segoe UI, sans-serif",fill:"#fff",left:12,top:9});r.push(s),t.getPorts().forEach(function(e){r.push(z(e,o))});var d=D(t),u=new i.fabric.Group(r,{id:t.id,left:Math.round(n.x-o.width/2-d),top:Math.round(n.y-o.height/2),hasRotatingPoint:!1,hasControls:!1,selectionBackgroundColor:"orange",hoverCursor:"pointer"});return e.add(u),u}(e,t),$(n))}),t.getNodesToRemove().forEach(function(t){var n=Z.get(t.id);e.remove(n),Z.remove(t.id)}),t.getEdges().forEach(function(n){var o;Z.has(n.id)?function(e,t,n){e.forEachObject(function(t){e.remove(t)});var i=U(n,t),o=i.path,r=i.arrowHead;e.addWithUpdate(o),e.addWithUpdate(r)}(o=Z.get(n.id),n,t):n.shouldRender()&&(o=function(e,t,n,o){var r=U(n,t,e,o),a=r.path,s=r.arrowHead,d=new i.fabric.Group([a,s],{id:t.id,hasRotatingPoint:!1,hasControls:!1,hasBorders:!1,evented:!1});return e.add(d),d}(e,n,t),$(o))}),t.getEdgesToRemove().forEach(function(t){var n=Z.get(t.id);e.remove(n),Z.remove(t.id)}),e.requestRenderAll(),t.renderEnd(),console.log("finish render, time spent: ",(performance.now()-n)/1e3,"s");var o=t.getNodes().length,r=t.getEdges().length;console.log("nodeNum:",o,"edgeNum:",r,"should render:",o+r,"rendered:",e.getObjects().length)},ee=function(){function e(t,n){Object(o.a)(this,e),this.canvas=t,this.graph=n,this._isRedrawPending=!1,this._isUsingWorker=!1,this._shouldRedrawNext=!1}return Object(r.a)(e,[{key:"init",value:function(){var e,t=this;this.resize(),this.graph.on("shouldRedraw",function(){t.requestRedraw()}),(e=this.canvas).on("mouse:down",function(e){var t=e.e;this.isDragging=!0,this.selection=!1,this.lastPosX=t.clientX,this.lastPosY=t.clientY}),e.on("mouse:move",function(e){if(this.isDragging){var t=e.e;this.viewportTransform[4]+=t.clientX-this.lastPosX,this.viewportTransform[5]+=t.clientY-this.lastPosY,this.requestRenderAll(),this.lastPosX=t.clientX,this.lastPosY=t.clientY}}),e.on("mouse:up",function(e){this.isDragging=!1,this.selection=!0,e.target&&console.log(e.target.id),this.forEachObject(function(e){e.setCoords()}),this.requestRenderAll()}),e.on("mouse:wheel",function(t){var n=t.e.deltaY,i=e.getZoom();(i-=n/300)>20&&(i=20),i<.1&&(i=.1),e.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},i),t.e.preventDefault(),t.e.stopPropagation()})}},{key:"resize",value:function(){var e={width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight};this._setCanvasSize(e),this.requestRedraw()}},{key:"_setCanvasSize",value:function(e){this.canvas.setWidth(e.width),this.canvas.setHeight(e.height)}},{key:"requestRedraw",value:function(){this._isRedrawPending||(this._isUsingWorker?this._shouldRedrawNext=!0:(this._isRedrawPending=!0,requestAnimationFrame(this._relayout.bind(this))))}},{key:"_relayout",value:function(){this._isRedrawPending=!1,this._isUsingWorker||(this._isUsingWorker=!0,console.log("start layout..."),this._startLayoutTime=performance.now(),M(this.graph,{marginX:20,marginY:20,useWorker:!0,callback:this._redraw.bind(this)}))}},{key:"_redraw",value:function(e){var t=this;this._isUsingWorker=!1,this._shouldRedrawNext&&(this._shouldRedrawNext=!1,this.requestRedraw()),console.log("finish layout, time spent: ",(performance.now()-this._startLayoutTime)/1e3,"s"),e&&(console.log("graph dimension",e.width,e.height),requestAnimationFrame(function(){Q(t.canvas,t.graph)})),console.log("redraw...")}}]),e}(),te="NODE_TO_NODE",ne="NODE_TO_PARAM",ie=function(e){function t(e,n){var i;return Object(o.a)(this,t),(i=Object(a.a)(this,Object(s.a)(t).call(this))).id=null,i.type=n,i.source=null,i.target=null,i._points=null,i._init(e),i}return Object(d.a)(t,e),Object(r.a)(t,[{key:"getPoints",value:function(){return this._points}},{key:"setPoints",value:function(e){this._points=e}},{key:"toString",value:function(){return[this.id,JSON.stringify(this.source),JSON.stringify(this.target)].join(",")}},{key:"shouldRender",value:function(){return!!this._points}},{key:"_init",value:function(e){var t,n,i=e.contextId;if(!e.sourceNodeId||!e.destinationNodeId)throw new Error("Undefined node message: "+JSON.stringify(e));if(this.source={id:c(i,e.sourceNodeId),port:f(i,e.sourceNodeId,e.fromChannel)},this.type===te)this.target={id:c(i,e.destinationNodeId),port:l(i,e.destinationNodeId,e.toChannel)};else{if(this.type!==ne)throw new Error("Unknown edge type: "+this.type);this.target={id:c(i,e.destinationNodeId),port:v(i,e.destinationNodeId,e.destinationParamName)}}this.id=(t=this.source.port,n=this.target.port,t+"|"+n)}}]),t}(h),oe=(n(312),new(function(){function e(t){Object(o.a)(this,e);var n=document.getElementById(t);n||((n=document.createElement("div")).setAttribute("id",t),document.body.appendChild(n)),this.elem=n}return Object(r.a)(e,[{key:"start",value:function(e){this.elem.classList.add(e)}},{key:"stop",value:function(e){this.elem.classList.remove(e)}},{key:"setText",value:function(e){this.elem.textContent=e}},{key:"clientWidth",value:function(){return this.elem.clientWidth}}]),e}())("text-sandbox")),re=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(a.a)(this,Object(s.a)(t).call(this,e)))._ports=null,n._init(e),n}return Object(d.a)(t,e),Object(r.a)(t,[{key:"getPortById",value:function(e){return this._ports.get(e)}},{key:"getPortsByType",value:function(e){return this._ports.filter(function(t){return t.type===e})}},{key:"getPorts",value:function(){return this._ports.values()}},{key:"_init",value:function(e){var t=this._computeNodeLayout(e),n=this._prepareInputPorts(e,t),i=this._prepareOutputPorts(e,t),o=this._prepareParamPorts(e,t);this._ports=this._createPortData(n.concat(i,o)),this.setSize({width:t.maxTextLength+12+30,height:t.totalHeight})}},{key:"_computeNodeLayout",value:function(e){var t=24*Math.max(1,e.numberOfInputs),n=14*e.audioParamNames.length,i=e.audioParamNames.length?6:8,o=Math.max(t+n+5+i,24*e.numberOfOutputs);return{inputPortSectionHeight:t,paramPortSectionHeight:n,maxTextLength:this._computeMaxTextLength(e),totalHeight:o}}},{key:"_computeMaxTextLength",value:function(e){var t=0;oe.start("audioParamText");for(var n=0;n<e.audioParamNames.length;n++)oe.setText(e.audioParamNames[n]),t=Math.max(t,oe.clientWidth());return oe.stop("audioParamText"),oe.start("nodeText"),oe.setText(this.nodeLabel),t=Math.max(t,oe.clientWidth()),oe.stop("nodeText"),t}},{key:"_prepareInputPorts",value:function(e,t){for(var n=[],i=15,o=0;o<e.numberOfInputs;o++)n.push({id:l(e.contextId,e.nodeId,o),type:B.IN,text:""+o,y:i}),i+=24;return n}},{key:"_prepareOutputPorts",value:function(e,t){for(var n=[],i=0;i<e.numberOfOutputs;i++)n.push({id:f(e.contextId,e.nodeId,i),type:B.OUT,text:""+i});return n}},{key:"_prepareParamPorts",value:function(e,t){for(var n=[],i=t.inputPortSectionHeight+5+5,o=0;o<e.audioParamNames.length;o++)n.push({id:v(e.contextId,e.nodeId,e.audioParamNames[o]),type:B.PARAM,text:e.audioParamNames[o],y:i}),i+=14;return n}},{key:"_createPortData",value:function(e){var t=this._validatePorts(e);if(t.length)throw new Error(t);return new k(e)}},{key:"_validatePorts",value:function(e){var t=this,n=[];return e.forEach(function(e){"object"!==typeof e&&n.push("Invalid port",e),t._isValidPortId(e.id)||n.push("port id is required")}),n}},{key:"_isValidPortId",value:function(e){return null!==e&&void 0!==e&&!Object(_.isObject)(e)}}]),t}(m),ae=n(71);var se,de=function(e){return function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,i=[],o=0;o<t;++o)i[o]=.1+.1*e();for(var r=0;r<n;++r)for(var a=1/(.1+e()),s=2*e()-.5,d=10/(.1+e()),u=0;u<t;u++){var h=(u/t-s)*d;i[u]+=a*Math.exp(-h*h)}for(var c=0;c<t;++c)i[c]=Math.max(0,i[c]);return i}},ue={contextId:1,numberOfInputs:1,numberOfOutputs:1,audioParamNames:["gain"]},he={AudioBufferSource:{numberOfInputs:0,audioParamNames:[]},Gain:null,Oscillator:{numberOfInputs:0,audioParamNames:["frequency","detune"]},BiquadFilter:{numberOfInputs:1,audioParamNames:["frequency","detune","Q","gain"]},AudioDestination:{numberOfOutputs:0,audioParamNames:[]}},ce=Object.keys(he).filter(function(e){return"AudioDestination"!==e}),le=function(e){var t,n,i,o,r=function(e){for(var t=0,n=1779033703^e.length;t<e.length;t++)n=(n=Math.imul(n^e.charCodeAt(t),3432918353))<<13|n>>>19;return function(){return n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),(n^=n>>>16)>>>0}}(e),a=(t=r(),n=r(),i=r(),o=r(),function(){var e=(t>>>=0)+(n>>>=0)|0;return t=n^n>>>9,n=(i>>>=0)+(i<<3)|0,i=(i=i<<21|i>>>11)+(e=e+(o=1+(o>>>=0)|0)|0)|0,(e>>>0)/4294967296}),s=function(e){return Math.floor(a()*e)},d=de(a);return{rand:a,randInt:s,randChoice:function(e){return e[s(e.length)]},randIntBetween:function(e,t){return Math.floor(e+a()*(t-e))},randBumps:d}}("small"),fe=le.rand,ve=le.randInt,ge=le.randChoice,me=le.randBumps,_e=function(){function e(t){Object(o.a)(this,e),this._count=0,this._maxLevels=6,this._maxNodesPerLevel=6,this._nodeIdsByLevel={},this._nodes={},this._messager=t}return Object(r.a)(e,[{key:"addRandomNodesAndLinks",value:function(e){var t=this;if(!this._manualMode){this._updateMaxLevelByTotalNum(this._count+e);var n=this._getRandomNodesByGausian(e),i=[];n.forEach(function(e,n){for(var o=0;o<e;o++){var r=t._nodeIdsByLevel[n];if(r&&r.length>t._maxNodesPerLevel)return;t._count+=1;var a=""+t._count,s=t._getRandomNode(a);s.level=n,t._nodes[a]=s,i.push(s),t._messager._addNode(s.nodeType,s.nodeId,s),t._nodeIdsByLevel[n]||(t._nodeIdsByLevel[n]=[]),t._nodeIdsByLevel[n].push(a)}}),console.log("added nodes:",i.length);var o=0;i.forEach(function(e){for(var n=Math.max(1,Math.ceil(3*fe())),i=0;i<n;i++){var r=t._getRandomTarget(e);r&&t._addRandomLinkTypeToPair(e,r)&&o++}}),console.log("added edges:",o),this._messager._addNode("AudioDestination","dest"),this._nodes.dest=this._getNodeByType("AudioDestination","dest"),this._connectLastLevelNodesToDestination("dest")}}},{key:"removeRandomNodesAndLinks",value:function(e){var t=this;if(!this._manualMode){var n=this._getRandomNodesByGausian(e),i=0;n.forEach(function(e,n){for(var o=0;o<e;o++){var r=t._nodeIdsByLevel[n];if(!r||0===r.length)return;var a=ge(r);delete t._nodes[a];var s=r.indexOf(a);t._nodeIdsByLevel[n].splice(s,1),i++,t._messager._removeNode(a)}}),console.log("removed nodes:",i),this._connectLastLevelNodesToDestination("dest")}}},{key:"_updateMaxLevelByTotalNum",value:function(e){var t=Math.ceil(e/24);this._maxLevels=6*Math.max(1,t),console.log(this._maxLevels,this._count)}},{key:"_getRandomNodesByGausian",value:function(e){var t=me(this._maxLevels,3),n=t.reduce(function(e,t){return e+t},0);return t.map(function(t){return Math.ceil(t/n*e)})}},{key:"_getRandomNode",value:function(e){var t=ge(ce);return this._getNodeByType(t,e)}},{key:"_getNodeByType",value:function(e,t){return p()({nodeType:e,nodeId:t},he[e],ue)}},{key:"_getRandomTarget",value:function(e){var t=e.level;return fe()<.6?this._tryTargetInLevel(t+1)||this._tryTargetInLevel(t+2):this._tryTargetInLevel(t+2)||this._tryTargetInLevel(t+1)}},{key:"_tryTargetInLevel",value:function(e){var t=this._nodeIdsByLevel[e];if(!P(t))for(var n=t.length+1;n>0;){var i=ge(t),o=this._nodes[i];if("AudioBufferSource"!==o.nodeType)return o;n--}}},{key:"_connectLastLevelNodesToDestination",value:function(e){for(var t=this,n=this._nodes[e],i=this._maxLevels;i>=0;i--){var o=this._nodeIdsByLevel[i];if(!P(o)){o.forEach(function(e){var i=t._nodes[e];t._addRandomLinkTypeToPair(i,n)});break}}}},{key:"_addRandomLinkTypeToPair",value:function(e,t){var n=!0;if(t.numberOfInputs&&t.audioParamNames.length){var i=t.numberOfInputs+t.audioParamNames.length,o=t.numberOfInputs/i;n=fe()<=o}else if(t.numberOfInputs)n=!0;else{if(!t.audioParamNames.length)return!1;n=!1}return n?this._messager._addNodeToNodeLink(e.nodeId,ve(e.numberOfOutputs),t.nodeId,ve(t.numberOfInputs)):this._messager._addNodeToParamLink(e.nodeId,ve(e.numberOfOutputs),t.nodeId,ge(t.audioParamNames)),!0}}]),e}(),ye=new(function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this)))._manualMode=!0,e._randomGraph=null,e}return Object(d.a)(t,e),Object(r.a)(t,[{key:"startMock",value:function(e){e=p()(e,{manualMode:!1}),this._manualMode=e.manualMode,e.manualMode?this._startManualMock(e):(this._randomGraph=new _e(this),this._startAutoMock(e))}},{key:"addRandomNodesAndLinks",value:function(e){this._manualMode||this._randomGraph.addRandomNodesAndLinks(e)}},{key:"removeRandomNodesAndLinks",value:function(e){this._manualMode||this._randomGraph.removeRandomNodesAndLinks(e)}},{key:"_startManualMock",value:function(e){e=p()(e,{allowCyclic:!1}),this._addNode("AudioBufferSource","s0"),this._addNode("Gain","g0"),this._addNode("Gain","g1"),this._addNode("Oscillator","o0"),this._addNode("Oscillator","o1"),this._addNode("Gain","g2"),this._addNode("Gain","g3"),this._addNode("Gain","g4"),this._addNode("BiquadFilter","b0"),this._addNode("AudioDestination","d0"),this._addNodeToNodeLink("s0","0","g0","0"),this._addNodeToNodeLink("s0","0","g1","0"),this._addNodeToNodeLink("s0","0","g4","0"),this._addNodeToParamLink("g0","0","o0","frequency"),this._addNodeToParamLink("g1","0","o1","frequency"),this._addNodeToNodeLink("o0","0","g2","0"),this._addNodeToNodeLink("o1","0","g3","0"),this._addNodeToNodeLink("g2","0","b0","0"),this._addNodeToNodeLink("g3","0","b0","0"),this._addNodeToParamLink("g4","0","b0","detune"),e.allowCyclic&&this._addNodeToParamLink("g3","0","o1","detune"),this._addNodeToNodeLink("b0","0","d0","0"),this._addNodeToNodeLink("g4","0","d0","0")}},{key:"_startAutoMock",value:function(e){this.addRandomNodesAndLinks(20)}},{key:"_addNode",value:function(e,t,n){n=p()(n,he[e],ue),this.trigger("KNodeCreated",Object(ae.a)({},ue,{nodeType:e,nodeId:t},n))}},{key:"_removeNode",value:function(e){this.trigger("kNodeDestroyed",Object(ae.a)({},ue,{nodeId:e}))}},{key:"_addNodeToNodeLink",value:function(e,t,n,i){this.trigger("KNodesConnected",{contextId:1,sourceNodeId:e,fromChannel:t,destinationNodeId:n,toChannel:i})}},{key:"_addNodeToParamLink",value:function(e,t,n,i){this.trigger("kNodeParamConnected",{contextId:1,sourceNodeId:e,fromChannel:t,destinationNodeId:n,destinationParamName:i})}}]),t}(u)),pe=document.getElementById("toggle-iframe"),ke=document.getElementById("demo-iframe"),Ne=new i.fabric.Canvas("root",{selection:!1}),be=new N,we=new ee(Ne,be);window.addEventListener("load",function(){we.init()}),window.addEventListener("resize",function(){we.resize()}),se=be,ye.on("KNodeCreated",function(e){new re(e).addTo(se)}),ye.on("kNodeDestroyed",function(e){var t=c(e.contextId,e.nodeId);se.removeNodeAndEdges(t)}),ye.on("KNodesConnected",function(e){new ie(e,te).addTo(se)}),ye.on("kNodeParamConnected",function(e){new ie(e,ne).addTo(se)}),ye.on("kNodesDisconnected",function(e){}),window.addEventListener("message",function(e){var t=e.data;switch(t.eventType){case"KNodeCreated":new re(t).addTo(se);break;case"kNodeDestroyed":var n=c(t.contextId,t.nodeId);se.removeNodeAndEdges(n);break;case"KNodesConnected":new ie(t,te).addTo(se);break;case"kNodeParamConnected":new ie(t,ne).addTo(se)}}),pe.addEventListener("click",function(){ke.classList.contains("show")?(ke.classList.add("hide"),ke.classList.remove("show")):(ke.classList.add("show"),ke.classList.remove("hide"))})}},[[127,1,2]]]);
//# sourceMappingURL=main.f7159603.chunk.js.map